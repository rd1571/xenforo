var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,e,d){b instanceof String&&(b=String(b));for(var f=b.length,a=0;a<f;a++){var c=b[a];if(e.call(d,c,a,b))return{i:a,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,d){b!=Array.prototype&&b!=Object.prototype&&(b[e]=d.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,e,d,f){if(e){d=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var a=b[f];a in d||(d[a]={});d=d[a]}b=b[b.length-1];f=d[b];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6","es3");
!function(b,e,d,f){XF.PermissionForm=XF.Element.newHandler({options:{form:null,filterInput:".js-permissionFilterInput",rows:".js-permission",rowLabel:".formRow-label",groups:".block-body",groupHeader:".block-formSectionHeader",headerCollapser:".collapseTrigger",quickSet:".js-permissionQuickSet",permissionType:null},$form:null,$groups:null,groups:{},$filter:null,filterTimer:null,init:function(){var a=this.$target,c=this.options,g=this;c.form&&(a=XF.findRelativeIf(c.form,a));this.$form=a;c.permissionType||
console.error("No permission type specified. Must be global or content.");var h=c.groupHeader,d=c.rows,e={};this.$groups=a.find(c.groups);this.$groups.each(function(){var a=b(this),c=a.xfUniqueId(),g=parseInt(a.data("moderator-permissions"),10)?!0:!1,f=a.prev(h),p=a.find(d);e[c]={$group:a,isModerator:g,$header:f,$rows:p}});this.groups=e;this.$filter=XF.findRelativeIf(c.filterInput,a);this.$filter.on({keyup:XF.proxy(this,"onKeyUp"),keypress:XF.proxy(this,"onKeyPress"),paste:XF.proxy(this,"onPaste")});
a.find(c.quickSet).click(function(){g.triggerQuickSet(b(this))});setTimeout(XF.proxy(this,"applyInitialState"),0)},applyInitialState:function(){var a=this.groups,c=this,g;for(g in a)if(a.hasOwnProperty(g)){var h=a[g];var d=h.$header;var e=h.$group;var f=!1;d.length&&h.isModerator&&(h.$rows.each(function(){if(c.isRowValueSet(b(this)))return f=!0,!1}),this.setGroupExpandedState(e,d,f))}},setGroupExpandedState:function(a,b,g){b.find(this.options.headerCollapser).toggleClass("is-active",g);a.toggleClass("is-active",
g);XF.layoutChange()},getRowValue:function(a){a=a.find("input, select").serializeArray();a=a[a.length-1].value;a.match(/^[0-9]+$/)&&(a=parseInt(a,10));return a},isValueSet:function(a){if("number"==typeof a)return 0!=a;switch(a){case "allow":case "content_allow":case "reset":case "deny":return!0;default:return!1}},isRowValueSet:function(a){return this.isValueSet(this.getRowValue(a))},onKeyUp:function(a){if(!a.ctrlKey&&!a.metaKey){switch(a.key){case "Tab":case "Enter":case "Shift":case "Control":case "Alt":break;
default:this.planFilter()}"Enter"!=a.key&&this.planFilter()}},onKeyPress:function(a){"Enter"==a.key&&(a.preventDefault(),this.filter())},onPaste:function(a){this.planFilter()},planFilter:function(){this.filterTimer&&clearTimeout(this.filterTimer);this.filterTimer=setTimeout(XF.proxy(this,"filter"),250)},filter:function(){this.filterTimer&&clearTimeout(this.filterTimer);var a=this.$filter.val(),c=this.groups,g=this.options.rowLabel;if(a.length){var d=new RegExp("("+XF.regexQuote(a)+")","i");var e=
new RegExp("("+XF.regexQuote(XF.htmlspecialchars(a))+")","i")}else e=d=!1;var f=!1,l;for(l in c)if(c.hasOwnProperty(l)){var m=!1,n=!1;a=c[l];a.$rows.find(".textHighlight").each(function(){var a=this.parentNode;b(this).replaceWith(this.childNodes);a.normalize()});a.$rows.each(function(){var a=b(this),c=!1;if(d){var h=a.find(g),k=h.text();d.test(k)&&(c=!0,k=XF.htmlspecialchars(k).replace(e,'<span class="textHighlight textHighlight--attention">$1</span>'),h.html(k))}else c=!0;a.css("display",c?"":"none");
c?m=!0:f=n=!0});d&&!m?(a.$group.css("display","none"),a.$header.css("display","none")):(a.$group.css("display",""),a.$header.css("display",""),a.$group.find(".formRow--permissionQuickSet").css("display",n?"none":""),d&&this.setGroupExpandedState(a.$group,a.$header,!0))}this.$form.find(".js-globalPermissionQuickSet").css("display",f?"none":"");XF.layoutChange()},triggerQuickSet:function(a){var c=a.data("value");a=a.data("target");var d=null,e=this;a&&a.length&&(d=b(a),d.length||(d=null));d||(d=this.$form);
d.find(this.options.rows).each(function(){e.setRowValue(b(this),c)})},setRowValue:function(a,c){if("flag"==a.data("permission-type"))a.find("input[type=radio][value="+c+"]").prop("checked",!0).trigger("click",{triggered:!0});else{var d="allow"==c||"content_allow"==c?-1:0;a.find("input[type=radio]").each(function(){var c=b(this);parseInt(c.val(),10)==d&&(c.prop("checked",!0).trigger("click",{triggered:!0}),c.data("xf-init")&&a.find("input[type=text], input[type=number]").val(d))})}}});XF.PermissionChoice=
XF.Element.newHandler({options:{inputSelector:'input[type="radio"]',inputContainerSelector:"li"},init:function(){var a=this;this.$target.on("click",this.options.inputSelector,function(){setTimeout(function(){a.update()},0)});this.update()},update:function(){var a=this.options.inputContainerSelector;this.$target.find(this.options.inputSelector).each(function(){var c=b(this);c.closest(a).toggleClass("is-selected",c.prop("checked"))})}});XF.Element.register("permission-form","XF.PermissionForm");XF.Element.register("permission-choice",
"XF.PermissionChoice")}(jQuery,window,document);

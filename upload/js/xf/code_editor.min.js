var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,e,d){b instanceof String&&(b=String(b));for(var f=b.length,a=0;a<f;a++){var c=b[a];if(e.call(d,c,a,b))return{i:a,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,d){b!=Array.prototype&&b!=Object.prototype&&(b[e]=d.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,e,d,f){if(e){d=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var a=b[f];a in d||(d[a]={});d=d[a]}b=b[b.length-1];f=d[b];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6","es3");
!function(b,e,d,f){XF.CodeEditor=XF.Element.newHandler({options:{indentUnit:4,indentWithTabs:!0,lineNumbers:!0,lineWrapping:!1,autoCloseBrackets:!0,mode:null,config:null,submitSelector:null,scrollbarStyle:"simple"},editor:null,$wrapper:null,init:function(){if(this.$target[0].parentNode.scrollHeight)this.initEditor();else this.$target.oneWithin("toggle:shown overlay:showing tab:shown",XF.proxy(this,"initEditor"))},initEditor:function(){var a=this.$target,c={},g={};if(!a.data("cmInitialized")){try{g=
b.parseJSON(this.options.config)}catch(h){g=this.options.config}try{c=b.parseJSON(b(".js-codeEditorLanguage").first().html())||{}}catch(h){console.error(h),c={}}this.editor=CodeMirror.fromTextArea(a.get(0),b.extend({mode:this.options.mode,indentUnit:this.options.indentUnit,indentWithTabs:this.options.indentWithTabs,lineNumbers:this.options.lineNumbers,lineWrapping:this.options.lineWrapping,autoCloseBrackets:this.options.autoCloseBrackets,readOnly:a.prop("readonly"),autofocus:a.prop("autofocus"),scrollbarStyle:this.options.scrollbarStyle,
phrases:c},g));this.$wrapper=b(this.editor.getWrapperElement());this.$wrapper.addClass(a.attr("class")).attr("dir","ltr");a.attr("class","");this.editor.refresh();XF.layoutChange();this.editor.on("keydown",XF.proxy(this,"keydown"));a.closest("form").on("ajax-submit:before",XF.proxy(this,"onSubmit"));a.trigger("code-editor:init",this.editor);a.data("cmInitialized",!0)}},onSubmit:function(a){this.editor.save()},keydown:function(a,c){if(XF.isMac()&&c.metaKey&&c.ctrlKey&&"f"==c.key||!XF.isMac()&&"F11"==
c.key)c.preventDefault(),a.setOption("fullScreen",!a.getOption("fullScreen"));"Escape"==c.key&&(c.stopPropagation(),a.getOption("fullScreen")&&a.setOption("fullScreen",!1));if(("s"==c.key||"Enter"==c.key)&&(XF.isMac()?c.metaKey:c.ctrlKey)){c.preventDefault();a=b(a.getTextArea()).closest("form");c=this.options.submitSelector;var g=a.find(c);c&&g.length?a.find(c).click():a.submit()}}});XF.CodeEditorSwitcherContainer=XF.Element.newHandler({options:{switcher:".js-codeEditorSwitcher",templateSuffixMode:0},
$switcher:null,editor:null,loading:!1,init:function(){this.$target.on("code-editor:init",XF.proxy(this,"initEditor"))},initEditor:function(a,b){var c=this.$target.find(this.options.switcher);if(c.length){this.$switcher=c;if(c.is("select, :radio"))c.on("change",XF.proxy(this,"change"));else if(c.is("input:not(:checkbox :radio)"))c.on("blur",XF.proxy(this,"blurInput")),setTimeout(function(){c.trigger("blur")},100);else{console.warn("Switcher only works for text inputs, radios and selects.");return}this.editor=
b}else console.warn("Switcher container has no switcher: %o",this.$target)},change:function(a){a=this.$switcher.find(":selected").val();this.switchLanguage(a)},blurInput:function(a){a=this.$switcher.val();this.options.templateSuffixMode&&(a=a.toLowerCase(),a=0<a.indexOf(".less")?"less":0<a.indexOf(".css")?"css":"html");this.switchLanguage(a)},switchLanguage:function(a){if(!this.loading){var c=this,d=this.editor,e=b(d.getTextArea());d.save();e.data("lang")!=a&&setTimeout(function(){var d="public"==
b("html").data("app")?"index.php?misc/code-editor-mode-loader":"admin.php?templates/code-editor-mode-loader";XF.ajax("post",XF.canonicalizeUrl(d),{language:a},XF.proxy(c,"handleAjax")).always(function(){c.loading=!1})},200)}},handleAjax:function(a){if(!a.errors&&!a.exception){a.redirect&&XF.redirect(a.redirect);var c=this.editor,d=b(c.getTextArea());XF.setupHtmlInsert(a.html,function(e,f){e="";a.mime?e=a.mime:a.mode&&(e=a.mode);c.setOption("mode",e);d.data("lang",a.language);d.data("config",JSON.stringify(a.config));
a.config&&b.each(a.config,function(a,b){c.setOption(a,b)})})}}});XF.Element.register("code-editor","XF.CodeEditor");XF.Element.register("code-editor-switcher-container","XF.CodeEditorSwitcherContainer")}(jQuery,window,document);

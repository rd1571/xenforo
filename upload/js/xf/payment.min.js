var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,f,e){c instanceof String&&(c=String(c));for(var h=c.length,a=0;a<h;a++){var b=c[a];if(f.call(e,b,a,c))return{i:a,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,f,e){c!=Array.prototype&&c!=Object.prototype&&(c[f]=e.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,f,e,h){if(f){e=$jscomp.global;c=c.split(".");for(h=0;h<c.length-1;h++){var a=c[h];a in e||(e[a]={});e=e[a]}c=c[c.length-1];h=e[c];f=f(h);f!=h&&null!=f&&$jscomp.defineProperty(e,c,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,e){return $jscomp.findInternal(this,c,e).v}},"es6","es3");
!function(c,f,e,h){XF.PaymentProviderContainer=XF.Element.newHandler({options:{},init:function(){if(this.$target.is("form"))this.$target.on("ajax-submit:response",XF.proxy(this,"submitResponse"));else console.error("%o is not a form",this.$target[0])},submitResponse:function(a,c){if(c.providerHtml){a.preventDefault();var b=this.$target.parent().find(".js-paymentProviderReply-"+c.purchasableTypeId+c.purchasableId);XF.setupHtmlInsert(c.providerHtml,function(a,c){b.html(a)})}}});XF.BraintreePaymentForm=
XF.Element.newHandler({options:{clientToken:null,formStyles:".js-formStyles"},xhr:null,init:function(){this.$target.on("submit",XF.proxy(this,"submit"));XF.loadScripts(["https://js.braintreegateway.com/web/3.19.0/js/client.min.js","https://js.braintreegateway.com/web/3.19.0/js/hosted-fields.min.js"],XF.proxy(this,"postInit"));var a=this.$target.closest(".overlay-container").data("overlay");a.on("overlay:hidden",function(){a.destroy()})},postInit:function(){if(this.options.clientToken){var a=this,
b=this.$target.find(this.options.formStyles)||{},d=b?c.parseJSON(b.first().html()):{};braintree.client.create({authorization:this.options.clientToken},function(b,g){b?XF.alert(b.message):braintree.hostedFields.create({client:g,styles:d,fields:{number:{selector:"#card-number",placeholder:"1234 1234 1234 1234"},expirationDate:{selector:"#card-expiry",placeholder:"MM / YY"},cvv:{selector:"#card-cvv",placeholder:"CVC"}}},function(b,d){if(b)XF.alert(b.message);else{b=d._fields;for(var g in b)b.hasOwnProperty(g)&&
c(b[g].containerElement).removeClass("is-disabled");d.on("cardTypeChange",function(a){a=1===a.cards.length?a.cards[0].type:"unknown";var b={visa:"fa-cc-visa","master-card":"fa-cc-mastercard","american-express":"fa-cc-amex",discover:"fa-cc-discover","diners-club":"fa-cc-diners",jcb:"fa-cc-jcb",unionpay:"fa-credit-card-alt",maestro:"fa-credit-card-alt",unknown:"fa-credit-card-alt"};if(a){var d=c("#brand-icon"),g="fa-credit-card-alt";a in b&&(g=b[a]);d[0].className="";d.addClass("fa");d.addClass("fa-lg");
d.addClass(g)}});a.$target.on("submit",function(b){b.preventDefault();d.tokenize(function(b,c){b?(c=b.message,(b=b.details.invalidFieldKeys)&&(c+=" ("+b.join(", ")+")"),XF.alert(c)):a.response(c)})})}})})}else console.error("Form must contain a data-client-token attribute.")},submit:function(a){a.preventDefault();return!1},response:function(a){this.xhr&&this.xhr.abort();this.xhr=XF.ajax("post",this.$target.attr("action"),a,XF.proxy(this,"complete"),{skipDefaultSuccess:!0})},complete:function(a){this.xhr=
null;a.redirect&&XF.redirect(a.redirect)}});XF.BraintreeApplePayForm=XF.Element.newHandler({options:{clientToken:null,currencyCode:"",boardTitle:"",title:"",amount:""},xhr:null,init:function(){XF.loadScripts(["https://js.braintreegateway.com/web/3.19.0/js/client.min.js","https://js.braintreegateway.com/web/3.19.0/js/apple-pay.min.js"],XF.proxy(this,"postInit"))},postInit:function(){if(this.options.clientToken){var a=this,b=!1;f.ApplePaySession&&ApplePaySession.canMakePayments()&&(b=!0);b&&braintree.client.create({authorization:this.options.clientToken},
function(b,c){b?XF.alert(b.message):braintree.applePay.create({client:c},function(b,c){b?XF.alert(b.message):ApplePaySession.canMakePaymentsWithActiveCard(c.merchantIdentifier).then(function(b){b?(a.$target.removeClass("u-hidden"),a.$target.find(".js-applePayButton").on("click",function(){var b=c.createPaymentRequest({total:{label:a.options.title,amount:a.options.amount}}),d=new ApplePaySession(2,b);d.onvalidatemerchant=function(b){c.performValidation({validationURL:b.validationURL,displayName:a.options.boardTitle},
function(a,b){a?(XF.alert(a.message),d.abort()):d.completeMerchantValidation(b)})};d.onpaymentauthorized=function(b){c.tokenize({token:b.payment.token},function(b,c){b?(XF.alert(b.message),d.completePayment(ApplePaySession.STATUS_FAILURE)):(d.completePayment(ApplePaySession.STATUS_SUCCESS),a.response(c))})};d.begin()})):console.warn("No Apple Pay card available")})})})}else console.error("Form must contain a data-client-token attribute.")},response:function(a){this.xhr&&this.xhr.abort();this.xhr=
XF.ajax("post",this.$target.attr("action"),a,XF.proxy(this,"complete"),{skipDefaultSuccess:!0})},complete:function(a){this.xhr=null;a.redirect&&XF.redirect(a.redirect)}});XF.BraintreePayPalForm=XF.Element.newHandler({options:{clientToken:null,paypalButton:"#paypal-button",testPayments:!1},xhr:null,init:function(){XF.loadScripts(["https://www.paypalobjects.com/api/checkout.js","https://js.braintreegateway.com/web/3.19.0/js/client.min.js","https://js.braintreegateway.com/web/3.19.0/js/paypal-checkout.min.js",
"https://js.braintreegateway.com/web/3.19.0/js/data-collector.min.js"],XF.proxy(this,"postInit"))},postInit:function(){if(this.options.clientToken){var a=this;braintree.client.create({authorization:this.options.clientToken},function(b,c){b?XF.alert(b.message):braintree.paypalCheckout.create({client:c},function(b,c){b?XF.alert(b.message):paypal.Button.render({env:a.options.testPayments?"sandbox":"production",payment:function(){return c.createPayment({flow:"vault",enableShippingAddress:!1})},onAuthorize:function(b,
d){return c.tokenizePayment(b).then(function(b){a.response(b)})},onCancel:function(a){console.log("checkout.js payment cancelled",JSON.stringify(a,0,2))},onError:function(a){XF.alert(a.message)}},a.options.paypalButton)})})}else console.error("Form must contain a data-client-token attribute.")},response:function(a){this.xhr&&this.xhr.abort();this.xhr=XF.ajax("post",this.$target.attr("action"),a,XF.proxy(this,"complete"),{skipDefaultSuccess:!0})},complete:function(a){this.xhr=null;a.redirect&&XF.redirect(a.redirect)}});
XF.StripePaymentForm=XF.Element.newHandler({options:{publishableKey:null,formStyles:".js-formStyles"},stripe:null,elements:null,elementsCache:{},processing:null,init:function(){this.$target.on("submit",XF.proxy(this,"submit"));XF.loadScript("https://js.stripe.com/v3/",XF.proxy(this,"postInit"))},postInit:function(){if(this.options.publishableKey){this.stripe=Stripe(this.options.publishableKey);this.elements=this.stripe.elements();this.initElements();var a=this.$target.closest(".overlay-container").data("overlay");
a.on("overlay:hidden",function(){a.destroy();delete XF.loadedScripts["https://js.stripe.com/v3/"];c("iframe").each(function(){var a=c(this);0<=a.attr("name").toLowerCase().indexOf("stripe")&&a.remove()})})}else console.error("Form must contain a data-publishable-key attribute.")},initElements:function(){var a=this.elements,b=this.$target.find(this.options.formStyles)||{};b=b?c.parseJSON(b.first().html()):{};var d=a.create("cardNumber",{style:b});d.mount("#card-number-element");this.elementsCache.cardNumber=
d;d.on("change",function(a){var b=a.brand,d={visa:"fa-cc-visa",mastercard:"fa-cc-mastercard",amex:"fa-cc-amex",discover:"fa-cc-discover",diners:"fa-cc-diners",jcb:"fa-cc-jcb",unknown:"fa-credit-card-alt"};a=c("#brand-icon");var e="fa-credit-card";a[0].className="";b&&"unknown"!==b?b in d?(e=d[b],b="fab",d="fa"+XF.config.fontAwesomeWeight):(b="fa"+XF.config.fontAwesomeWeight,d="fab"):(b="fa"+XF.config.fontAwesomeWeight,d="fab");a.addClass(b);a.removeClass(d);a.addClass("fa-lg");a.addClass(e)});d=a.create("cardExpiry",
{style:b});d.mount("#card-expiry-element");this.elementsCache.cardExpiry=d;a=a.create("cardCvc",{style:b});a.mount("#card-cvc-element");this.elementsCache.cardCvc=a},submit:function(a){a.preventDefault();if(this.processing)return!1;this.processing=!0;var b=this;a=c(a.target);var d=this.stripe,e=this.elementsCache.cardNumber,g=c("#card-errors-container"),f=g.find("#card-errors");a.addClass("is-disabled").prop("disabed",!0);d.createToken(e).then(function(a){a.error?(f.text(a.error.message),f.removeClass("u-hidden"),
g.removeClass("u-hidden"),b.processing=!1):(g.addClass("u-hidden"),f.addClass("u-hidden"),f.text(""),b.stripeTokenHandler(a.token))})},stripeTokenHandler:function(a){var b=this.$target,d=c('<input type="hidden" />');d.attr("name","response[id]");d.attr("value",a.id);b.append(d);this.response()},response:function(){var a=this.$target,b=XF.getDefaultFormData(a);XF.ajax("post",a.attr("action"),b,XF.proxy(this,"complete"),{skipDefaultSuccess:!0})},complete:function(a){this.processing=!1;a.redirect&&XF.redirect(a.redirect)}});
XF.StripeApplePayForm=XF.Element.newHandler({options:{publishableKey:null,currencyCode:"",title:"",amount:""},xhr:null,init:function(){var a=this.$target;a.find(".js-applePayButton").on("click",XF.proxy(this,"click"));a.on("submit",XF.proxy(this,"submit"));XF.loadScript("https://js.stripe.com/v2/",XF.proxy(this,"postInit"))},postInit:function(){if(this.options.publishableKey){var a=this;Stripe.setPublishableKey(this.options.publishableKey);Stripe.applePay.checkAvailability(function(b){b&&a.$target.removeClass("u-hidden")})}else console.error("Form must contain a data-publishable-key attribute.")},
click:function(){var a=this,b={countryCode:XF.getLocale().split("_").pop(),currencyCode:this.options.currencyCode,total:{label:this.options.title,amount:this.options.amount}};b=Stripe.applePay.buildSession(b,function(b,c){a.xhr&&a.xhr.abort();a.xhr=XF.ajax("post",a.$target.attr("action"),{"response[id]":b.token.id},function(b){c(ApplePaySession.STATUS_SUCCESS);a.xhr=null;b.redirect&&XF.redirect(b.redirect)},{skipDefaultSuccess:!0});a.xhr.fail(function(){c(ApplePaySession.STATUS_FAILURE)})},function(a){XF.alert(a)});
b.oncancel=function(){console.log("User hit the cancel button in the payment window")};b.begin()}});XF.Element.register("payment-provider-container","XF.PaymentProviderContainer");XF.Element.register("braintree-payment-form","XF.BraintreePaymentForm");XF.Element.register("braintree-apple-pay-form","XF.BraintreeApplePayForm");XF.Element.register("braintree-paypal-form","XF.BraintreePayPalForm");XF.Element.register("stripe-payment-form","XF.StripePaymentForm");XF.Element.register("stripe-apple-pay-form",
"XF.StripeApplePayForm")}(jQuery,window,document);

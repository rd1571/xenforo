var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,h,g){b instanceof String&&(b=String(b));for(var k=b.length,a=0;a<k;a++){var c=b[a];if(h.call(g,c,a,b))return{i:a,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,h,g){b!=Array.prototype&&b!=Object.prototype&&(b[h]=g.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,h,g,k){if(h){g=$jscomp.global;b=b.split(".");for(k=0;k<b.length-1;k++){var a=b[k];a in g||(g[a]={});g=g[a]}b=b[b.length-1];k=g[b];h=h(k);h!=k&&null!=h&&$jscomp.defineProperty(g,b,{configurable:!0,writable:!0,value:h})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,g){return $jscomp.findInternal(this,b,g).v}},"es6","es3");
!function(b,h,g,k){XF.InlineMod=XF.Element.newHandler({options:{type:null,href:null,cookieBase:"inlinemod",toggle:"input[type=checkbox].js-inlineModToggle",toggleContainer:".js-inlineModContainer",containerClass:"is-mod-selected",actionTrigger:".js-inlineModTrigger",counter:".js-inlineModCounter",viewport:"body"},cookie:null,$action:null,xhr:null,init:function(){if(this.options.type){this.options.href||console.error("No inline mod href specified");this.cookie=this.options.cookieBase+"_"+this.options.type;
this.$target.on("click",this.options.toggle,XF.proxy(this,"onToggle"));this.$target.on("click",this.options.actionTrigger,XF.proxy(this,"onActionTrigger"));var a=this.getCookieValue();this._initialLoad(a);this._updateCounter(a.length);var c=this;setTimeout(function(){b(g).on("xf:reinit",function(a,d){c.$target.has(d)&&b(d).find(c.options.toggle).length&&c.recalculateFromCookie()})},0)}else console.error("No inline mod type specified")},_initialLoad:function(a){this.$target.find(this.options.toggle).each(function(){b(this).prop("checked",
!1)});var c={};if(a.length){this.$target.find(this.options.toggle).each(function(){var a=b(this);c[a.val()]=a});for(var e=a.length,d,f=0;f<e;f++)d=a[f],c[d]&&(c[d].prop("checked",!0),this.toggleContainer(c[d],!0))}},recalculateFromCookie:function(){for(var a=this.getCookieValue(),c=a.length,e={},d=this,f=0;f<c;f++)e[a[f]]=!0;this.$target.find(this.options.toggle).each(function(){var a=b(this),c=a.is(":checked"),f=e[a.val()]?!0:!1;c&&!f?(a.prop("checked",!1),d.toggleContainer(a,!1)):!c&&f&&(a.prop("checked",
!0),d.toggleContainer(a,!0))})},deselect:function(){this.setCookieValue([]);this.recalculateFromCookie();this.hideBar()},selectAll:function(){var a=this.getCookieValue();this.$target.find(this.options.toggle).each(function(){var c=parseInt(b(this).val(),10);-1===b.inArray(c,a)&&a.push(c)});this.setCookieValue(a);this.recalculateFromCookie();return a},deselectPage:function(){var a=this.getCookieValue(),c=[],e=[];this.$target.find(this.options.toggle).each(function(){e.push(parseInt(b(this).val(),10))});
for(var d=0;d<a.length;d++)-1===b.inArray(a[d],e)&&c.push(a[d]);this.setCookieValue(c);this.recalculateFromCookie();c.length?this.loadBar():this.hideBar();return c},onToggle:function(a){a=b(a.target);var c=a.is(":checked");var e=this.toggleSelectedInCookie(a.val(),c);this.toggleContainer(a,c);e.length?this.loadBar():this.hideBar()},onActionTrigger:function(a){a.preventDefault();this.loadBar()},loadBar:function(a){var c=this;this.loadTimeout&&clearTimeout(this.loadTimeout);this.loadTimeout=setTimeout(function(){c.xhr&&
c.xhr.abort();c.xhr=XF.ajax("GET",c.options.href,{type:c.options.type},function(b){c._showBar(b,a)})},10)},_showBar:function(a,c){this.xhr=null;if(a.html){var e=this;XF.setupHtmlInsert(a.html,function(a,f,g){f=!1;e.$bar&&(f=!0,e.$bar.remove(),e.$bar=null);e._setupBar(a);e.$bar=a;XF.bottomFix(a);if(XF.browser.ios){var d=b('<div class="inlineModBarCover" />'),h=e.$bar,k=h.find(".js-inlineModAction");d.click(function(){k.blur()});k.on({focus:function(){h.before(d)},blur:function(){setTimeout(function(){d.remove()},
200)}})}f&&a.css("transition-duration","0s");a.addClassTransitioned("is-active");f&&setTimeout(function(){a.css("transition-duration","")},0);c&&c(a)})}},_setupBar:function(a){a.on("click",":submit",XF.proxy(this,"submit")).on("click",".js-inlineModClose",XF.proxy(this,"hideBar")).on("click",".js-inlineModSelectAll",XF.proxy(this,"onSelectAllClick"));var c=this.$target.find(this.options.toggle);c.length==c.filter(":checked").length&&a.find("input[type=checkbox].js-inlineModSelectAll").prop("checked",
!0)},onSelectAllClick:function(a){b(a.target).is(":checked")?this.selectAll().length?this.loadBar(function(a){a.find("input[type=checkbox].js-inlineModSelectAll").prop("checked",!0)}):this.deselect():this.deselectPage()},submit:function(){if(this.$bar){var a=this.$bar.find(".js-inlineModAction");if(a.length){if(a=a.val())if("deselect"==a)this.deselect();else{var c=this;XF.ajax("POST",this.options.href,{type:this.options.type,action:a},function(a){c._handleSubmitResponse(a)},{skipDefaultSuccess:!0})}}else console.error("No action selector found.")}},
_handleSubmitResponse:function(a){a.html?XF.setupHtmlInsert(a.html,function(a,b){a=XF.getOverlayHtml({html:a,title:b.h1||b.title});XF.showOverlay(a)}):"ok"==a.status&&a.redirect?a.message?XF.flashMessage(a.message,1E3,function(){XF.redirect(a.redirect)}):XF.redirect(a.redirect):XF.alert("Unexpected response");this.hideBar()},hideBar:function(){if(this.$bar){var a=this;this.$bar.removeClassTransitioned("is-active",function(){a.$bar&&a.$bar.remove();a.$bar=null})}},_updateCounter:function(a){var c=
this.$target.find(this.options.actionTrigger),b=c.find(".inlineModButton");b.length||(b=c);b.toggleClass("is-mod-active",0<a);this.$target.find(this.options.counter).text(a)},toggleContainer:function(a,c){c=c?"addClass":"removeClass";a.closest(this.options.toggleContainer)[c](this.options.containerClass)},toggleSelectedInCookie:function(a,c){a=parseInt(a,10);var e=this.getCookieValue(),d=b.inArray(a,e),f=!1;c?0>d&&(e.push(a),f=!0):0<=d&&(e.splice(d,1),f=!0);return f?this.setCookieValue(e):e},getCookieValue:function(){var a=
XF.Cookie.get(this.cookie);if(!a)return[];a=a.split(",");for(var c=a.length,b=0;b<c;b++)a[b]=parseInt(a[b],10);return a},setCookieValue:function(a){a.length?(a.sort(function(a,b){return a-b}),XF.Cookie.set(this.cookie,a.join(","))):XF.Cookie.remove(this.cookie);this._updateCounter(a.length);return a}});XF.Element.register("inline-mod","XF.InlineMod")}(jQuery,window,document);
